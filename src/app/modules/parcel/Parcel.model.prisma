model Parcel {
  id           String    @id @default(uuid())
  slug         String    @unique
  requested_at DateTime  @default(now())
  accepted_at  DateTime?
  started_at   DateTime?
  delivered_at DateTime?
  completed_at DateTime?
  cancelled_at DateTime?
  payment_at   DateTime?

  user_id   String?
  user      User?   @relation("UserParcel", fields: [user_id], references: [id], onDelete: SetNull)
  driver_id String?
  driver    User?   @relation("DriverParcel", fields: [driver_id], references: [id], onDelete: SetNull)

  // Pickup location fields
  pickup_type    String  @default("Point")
  pickup_lat     Float
  pickup_lng     Float
  pickup_address String?

  // Dropoff location fields
  dropoff_type    String  @default("Point")
  dropoff_lat     Float
  dropoff_lng     Float
  dropoff_address String?

  // Parcel location fields
  location_type    String? @default("Point")
  location_lat     Float?
  location_lng     Float?
  location_address String?

  status      EParcelStatus @default(REQUESTED)
  parcel_type EParcelType
  weight      Float
  amount      Float
  total_cost  Float         @default(0.00)

  //! PROCESSING
  processing_driver_id String?
  processing_at        DateTime?
  is_processing        Boolean   @default(false)
  //! end

  //! DELIVERY PROOF
  delivery_proof_files String[] @default([])
  delivery_lat         Float?
  delivery_lng         Float?

  helper       ParcelHelper? @relation("ParcelHelper")
  transactions Transaction[]

  @@index([pickup_lat, pickup_lng])
  @@index([dropoff_lat, dropoff_lng])
  @@map("parcels")
}

enum EParcelType {
  SMALL
  MEDIUM
  LARGE
}

enum EParcelStatus {
  REQUESTED
  ACCEPTED
  STARTED
  DELIVERED
  COMPLETED
  CANCELLED
}

model ParcelHelper {
  id         String   @id @default(uuid())
  parcel_id  String   @unique
  driver_ids String[]
  search_at  DateTime @default(now())

  parcel Parcel @relation("ParcelHelper", fields: [parcel_id], references: [id], onDelete: Cascade)

  @@map("_parcels_helper")
}
