model Parcel {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  slug         String    @unique
  requested_at DateTime  @default(now())
  accepted_at  DateTime?
  started_at   DateTime?
  delivered_at DateTime?
  completed_at DateTime?
  cancelled_at DateTime?

  user_id   String  @db.ObjectId
  user      User    @relation("UserParcel", fields: [user_id], references: [id])
  driver_id String? @db.ObjectId
  driver    User?   @relation("DriverParcel", fields: [driver_id], references: [id])

  pickup_location  TLocation
  dropoff_location TLocation

  status      EParcelStatus @default(REQUESTED)
  parcel_type EParcelType
  weight      Float
  amount      Float
  total_cost  Float         @default(0.00)

  helper ParcelHelper? @relation("ParcelHelper")

  @@map("parcels")
}

enum EParcelType {
  SMALL
  MEDIUM
  LARGE
}

enum EParcelStatus {
  REQUESTED
  ACCEPTED
  STARTED
  DELIVERED
  COMPLETED
  CANCELLED
}

model ParcelHelper {
  id                    String   @id @default(auto()) @map("_id") @db.ObjectId
  parcel_id             String   @unique @db.ObjectId
  driver_ids            String[] // include 10 nearest drivers
  next_driver_search_at DateTime @default(now())

  parcel Parcel @relation("ParcelHelper", fields: [parcel_id], references: [id])

  @@map("_parcels_helper")
}
